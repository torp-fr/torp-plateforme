# APIs Open-Source B2B - Documentation complÃ¨te

Architecture modulaire avec **prioritÃ© aux APIs gratuites**, enrichissement optionnel avec Pappers.

## ğŸ¯ Architecture (ordre de prioritÃ©)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1ï¸âƒ£ API SIRENE (INSEE) - Open Data PRIORITAIRE                 â”‚
â”‚    âœ… Gratuite, sans authentification                          â”‚
â”‚    ğŸ“¦ DonnÃ©es: SIRET, raison sociale, NAF, forme juridique    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2ï¸âƒ£ Base Adresse Nationale (BAN) - Open Data OPTIONNEL        â”‚
â”‚    âœ… Gratuite, sans authentification                          â”‚
â”‚    ğŸ“¦ Normalisation et validation d'adresses                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3ï¸âƒ£ Pappers - Enrichissement OPTIONNEL                         â”‚
â”‚    ğŸ’° Payant (clÃ© API requise)                                 â”‚
â”‚    ğŸ“¦ Capital social, CA, dirigeants, bilans                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4ï¸âƒ£ Mock - DÃ©veloppement FALLBACK                              â”‚
â”‚    âœ… Gratuit, donnÃ©es de test                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“š API 1 : SIRENE (INSEE) - Open Data

### Informations gÃ©nÃ©rales
- **URL** : https://api.insee.fr/catalogue/
- **CoÃ»t** : Gratuit
- **Authentification** : Aucune
- **Rate limit** : 30 requÃªtes/minute
- **Documentation** : https://api.insee.fr/catalogue/

### DonnÃ©es disponibles
- âœ… SIREN (9 chiffres)
- âœ… SIRET (14 chiffres)
- âœ… DÃ©nomination (raison sociale)
- âœ… Forme juridique
- âœ… Code NAF (activitÃ©)
- âœ… Adresse du siÃ¨ge
- âœ… Code postal / Commune
- âœ… Date de crÃ©ation
- âœ… Tranche d'effectif

### Endpoint
```bash
GET https://api.insee.fr/entreprises/sirene/V3/siret/{siret}
```

### Exemple de requÃªte
```typescript
const response = await fetch(
  'https://api.insee.fr/entreprises/sirene/V3/siret/85331999200014',
  {
    headers: {
      'Accept': 'application/json'
    }
  }
);

const data = await response.json();
console.log(data.etablissement.uniteLegale.denominationUniteLegale);
// "TORP FRANCE"
```

### Exemple de rÃ©ponse
```json
{
  "etablissement": {
    "siret": "85331999200014",
    "uniteLegale": {
      "siren": "853319992",
      "denominationUniteLegale": "TORP FRANCE",
      "categorieJuridiqueUniteLegale": "5710",
      "dateCreationUniteLegale": "2019-05-15"
    },
    "adresseEtablissement": {
      "numeroVoieEtablissement": "123",
      "typeVoieEtablissement": "RUE",
      "libelleVoieEtablissement": "DE LA PAIX",
      "codePostalEtablissement": "75001",
      "libelleCommuneEtablissement": "PARIS"
    },
    "activitePrincipaleEtablissement": "62.01Z",
    "trancheEffectifsEtablissement": "01"
  }
}
```

### Test manuel
```bash
curl "https://api.insee.fr/entreprises/sirene/V3/siret/85331999200014" \
  -H "Accept: application/json"
```

### Fichier
- `src/services/api/external/sirene.service.ts`
- Fonction : `getSireneData(siret: string)`

---

## ğŸ“š API 2 : Base Adresse Nationale (BAN)

### Informations gÃ©nÃ©rales
- **URL** : https://adresse.data.gouv.fr
- **CoÃ»t** : Gratuit
- **Authentification** : Aucune
- **Rate limit** : Aucune
- **Documentation** : https://adresse.data.gouv.fr/api-doc/adresse

### UtilitÃ©
- Normaliser les adresses incomplÃ¨tes
- Obtenir les coordonnÃ©es GPS
- Valider et enrichir les adresses

### Endpoint
```bash
GET https://api-adresse.data.gouv.fr/search/?q={adresse}
```

### Exemple de requÃªte
```typescript
const response = await fetch(
  'https://api-adresse.data.gouv.fr/search/?q=123%20rue%20de%20la%20paix%20paris&limit=5'
);

const data = await response.json();
console.log(data.features[0].properties.label);
// "123 Rue de la Paix 75001 Paris"
```

### Exemple de rÃ©ponse
```json
{
  "features": [
    {
      "properties": {
        "label": "123 Rue de la Paix 75001 Paris",
        "score": 0.98,
        "housenumber": "123",
        "street": "Rue de la Paix",
        "postcode": "75001",
        "city": "Paris",
        "citycode": "75101"
      },
      "geometry": {
        "coordinates": [2.3319, 48.8697]
      }
    }
  ]
}
```

### Test manuel
```bash
curl "https://api-adresse.data.gouv.fr/search/?q=123%20rue%20de%20la%20paix%20paris"
```

### Fichier
- `src/services/api/external/ban.service.ts`
- Fonction : `searchAddress(query: string)`
- Fonction : `enrichAddress(street, city, postcode)`

---

## ğŸ“š API 3 : Pappers (Enrichissement optionnel)

### Informations gÃ©nÃ©rales
- **URL** : https://www.pappers.fr/api
- **CoÃ»t** : Payant (abonnement requis)
- **Authentification** : ClÃ© API
- **Documentation** : https://www.pappers.fr/api/documentation

### DonnÃ©es enrichies (non disponibles dans SIRENE)
- âœ… Capital social
- âœ… Chiffre d'affaires (derniers bilans)
- âœ… RÃ©sultat net
- âœ… Liste des dirigeants
- âœ… BÃ©nÃ©ficiaires effectifs
- âœ… Historique des modifications

### Endpoint
```bash
GET https://api.pappers.fr/v2/entreprise?siret={siret}&api_token={token}
```

### Configuration
```env
VITE_PAPPERS_API_KEY=votre_cle_pappers
```

### Exemple de requÃªte
```typescript
const API_KEY = import.meta.env.VITE_PAPPERS_API_KEY;

const response = await fetch(
  `https://api.pappers.fr/v2/entreprise?siret=85331999200014&api_token=${API_KEY}`
);

const data = await response.json();
console.log(data.capital_social); // 10000
```

### Fichier
- `src/services/api/external/pappers.service.ts`
- Fonction : `getPappersData(siret: string)`
- Fonction : `enrichWithPappers(sireneData)`

---

## ğŸ§ª Tests unitaires

### Test SIRENE seul
```typescript
import { getSireneData } from '@/services/api/external/sirene.service';

const data = await getSireneData('85331999200014');
console.log(data);
// { siren: "853319992", denomination: "TORP FRANCE", ... }
```

### Test BAN seul
```typescript
import { searchAddress } from '@/services/api/external/ban.service';

const results = await searchAddress('123 rue de la paix paris');
console.log(results[0].label);
// "123 Rue de la Paix 75001 Paris"
```

### Test Pappers seul
```typescript
import { getPappersData } from '@/services/api/external/pappers.service';

const data = await getPappersData('85331999200014');
console.log(data.capital_social); // 10000
```

### Test complet (workflow)
```typescript
import { verifySiret } from '@/services/api/pro/companyService';

const result = await verifySiret('85331999200014');
console.log(result);
// {
//   valid: true,
//   data: {
//     siren: "853319992",
//     siret: "85331999200014",
//     raison_sociale: "TORP FRANCE",
//     adresse: "123 Rue de la Paix",
//     code_postal: "75001",
//     ville: "Paris",
//     capital_social: 10000 // Si Pappers configurÃ©
//   }
// }
```

---

## âš™ï¸ Configuration Vercel

### Variables d'environnement (optionnelles)

```env
# Pappers (enrichissement optionnel)
VITE_PAPPERS_API_KEY=votre_cle_pappers

# Aucune configuration requise pour SIRENE et BAN (100% gratuit)
```

### Dashboard Vercel
1. Aller dans **Settings â†’ Environment Variables**
2. Ajouter uniquement si vous avez un abonnement Pappers :
   - Key: `VITE_PAPPERS_API_KEY`
   - Value: Votre clÃ© API Pappers

---

## ğŸ“Š Comparaison des sources

| DonnÃ©e | SIRENE | BAN | Pappers | Mock |
|--------|--------|-----|---------|------|
| SIRET | âœ… | âŒ | âœ… | âœ… |
| Raison sociale | âœ… | âŒ | âœ… | âœ… |
| Forme juridique | âœ… | âŒ | âœ… | âœ… |
| Code NAF | âœ… | âŒ | âœ… | âœ… |
| Adresse | âš ï¸ | âœ… | âœ… | âœ… |
| Code postal | âœ… | âœ… | âœ… | âœ… |
| Ville | âœ… | âœ… | âœ… | âœ… |
| Date crÃ©ation | âœ… | âŒ | âœ… | âœ… |
| Effectif | âš ï¸ (tranche) | âŒ | âœ… (prÃ©cis) | âœ… |
| Capital social | âŒ | âŒ | âœ… | âŒ |
| Chiffre affaires | âŒ | âŒ | âœ… | âŒ |
| Dirigeants | âŒ | âŒ | âœ… | âŒ |

**LÃ©gende** :
- âœ… Disponible
- âš ï¸ Partiel
- âŒ Non disponible

---

## ğŸš€ Workflow complet

```mermaid
graph TD
    A[Saisie SIRET] --> B[Validation format]
    B --> C[API SIRENE Open Data]
    C --> D{DonnÃ©es OK?}
    D -->|Oui| E[BAN - Enrichir adresse]
    D -->|Non| Z[Mock]
    E --> F{Pappers configurÃ©?}
    F -->|Oui| G[Enrichir avec Pappers]
    F -->|Non| H[Retourner donnÃ©es SIRENE+BAN]
    G --> H
```

---

## ğŸ’¡ Avantages de cette architecture

1. **100% gratuit par dÃ©faut** (SIRENE + BAN)
2. **Modulaire** : chaque API testable indÃ©pendamment
3. **RÃ©siliente** : fallback automatique
4. **Ã‰volutive** : facile d'ajouter d'autres sources (API Geo, etc.)
5. **Pappers optionnel** : uniquement si besoin de donnÃ©es enrichies

---

## ğŸ“ Checklist d'implÃ©mentation

- [x] Service SIRENE (`sirene.service.ts`)
- [x] Service BAN (`ban.service.ts`)
- [x] Service Pappers (`pappers.service.ts`)
- [x] IntÃ©gration dans `companyService.ts`
- [x] Logs de debug pour chaque Ã©tape
- [ ] Tests unitaires pour chaque service
- [ ] Documentation UI : afficher source des donnÃ©es
- [ ] Monitoring : tracker le taux d'utilisation de chaque API
